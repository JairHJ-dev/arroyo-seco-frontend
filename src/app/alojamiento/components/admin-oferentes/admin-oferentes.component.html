<section class="oferentes">
  <header class="toolbar">
    <div class="search">
      <input
        type="text"
        placeholder="Buscar oferente por nombre, correo o estado"
        [(ngModel)]="searchTerm"
      />
      <button type="button" aria-label="Buscar">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23 6.5 6.5 0 1 0-6.5 6.5 6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM10 14a4 4 0 1 1 0-8 4 4 0 0 1 0 8z" />
        </svg>
      </button>
    </div>

    <button type="button" class="btn primary" (click)="abrirRegistro()">
      Registrar oferente
    </button>
  </header>

  <div class="table-wrapper" *ngIf="filteredOferentes.length; else emptyState">
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Teléfono</th>
          <th>Alojamientos</th>
          <th>Estado</th>
          <th class="actions">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let oferente of filteredOferentes">
          <td>{{ oferente.nombre }}</td>
          <td>{{ oferente.correo }}</td>
          <td>{{ oferente.telefono }}</td>
          <td>{{ oferente.alojamientos }}</td>
          <td>
            <span class="pill" [ngClass]="oferente.estado.toLowerCase()">
              {{ oferente.estado }}
            </span>
          </td>
          <td class="actions">
            <button type="button" class="btn ghost" (click)="abrirDetalles(oferente)">Ver detalles</button>
            <button type="button" class="btn" [class.warning]="oferente.estado === 'Activo'" [class.success]="oferente.estado !== 'Activo'" (click)="toggleEstado(oferente)">
              {{ oferente.estado === 'Activo' ? 'Desactivar' : 'Activar' }}
            </button>
            <button type="button" class="btn ghost" (click)="abrirEditar(oferente)">Editar</button>
            <button type="button" class="btn danger" (click)="eliminar(oferente)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #emptyState>
    <div class="empty">
      <p>No se encontraron oferentes para "{{ searchTerm }}".</p>
    </div>
  </ng-template>

  <!-- Modal detalles -->
  <div class="modal-backdrop" *ngIf="modalDetallesAbierto" (click)="cerrarDetalles()"></div>
  <div class="modal" *ngIf="modalDetallesAbierto && seleccionado as s">
    <div class="modal__header">
      <h3>Detalles del oferente</h3>
      <button class="close" (click)="cerrarDetalles()">×</button>
    </div>
    <div class="modal__body">
      <div class="detail-grid">
        <div><strong>Nombre:</strong> {{ s.nombre }}</div>
        <div><strong>Correo:</strong> {{ s.correo }}</div>
        <div><strong>Teléfono:</strong> {{ s.telefono }}</div>
        <div><strong>Alojamientos:</strong> {{ s.alojamientos }}</div>
        <div><strong>Estado:</strong> {{ s.estado }}</div>
      </div>
    </div>
    <div class="modal__footer">
      <button class="btn" (click)="cerrarDetalles()">Cerrar</button>
    </div>
  </div>

  <!-- Modal registro -->
  <div class="modal-backdrop" *ngIf="modalRegistroAbierto" (click)="cerrarRegistro()"></div>
  <div class="modal" *ngIf="modalRegistroAbierto">
    <div class="modal__header">
      <h3>Registrar nuevo oferente</h3>
      <button class="close" (click)="cerrarRegistro()">×</button>
    </div>
    <form #f="ngForm" (ngSubmit)="registrar(f)">
      <div class="modal__body form-grid">
        <label>
          Nombre completo
          <input type="text" name="nombre" [(ngModel)]="nuevo.nombre" required />
        </label>
        <label>
          Correo
          <input type="email" name="correo" [(ngModel)]="nuevo.correo" required />
        </label>
        <label>
          Teléfono
          <input type="tel" name="telefono" [(ngModel)]="nuevo.telefono" required />
        </label>
      </div>
      <div class="modal__footer">
        <button class="btn ghost" type="button" (click)="cerrarRegistro()">Cancelar</button>
        <button class="btn primary" [disabled]="f.invalid">Registrar</button>
      </div>
    </form>
  </div>

  <!-- Modal edición -->
  <div class="modal-backdrop" *ngIf="modalEditarAbierto" (click)="cerrarEditar()"></div>
  <div class="modal" *ngIf="modalEditarAbierto && editar as e">
    <div class="modal__header">
      <h3>Editar oferente</h3>
      <button class="close" (click)="cerrarEditar()">×</button>
    </div>
    <form #fe="ngForm" (ngSubmit)="guardarEditar(fe)">
      <div class="modal__body form-grid">
        <label>
          Nombre completo
          <input type="text" name="nombre" [(ngModel)]="e.nombre" required />
        </label>
        <label>
          Correo
          <input type="email" name="correo" [(ngModel)]="e.correo" required />
        </label>
        <label>
          Teléfono
          <input type="tel" name="telefono" [(ngModel)]="e.telefono" required />
        </label>
      </div>
      <div class="modal__footer">
        <button class="btn ghost" type="button" (click)="cerrarEditar()">Cancelar</button>
        <button class="btn primary" [disabled]="fe.invalid">Guardar cambios</button>
      </div>
    </form>
  </div>
</section>
